<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Expoya AI-Content-Engine</title>
  <link rel="stylesheet" href="assets/style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="app-container">
  <!-- Linker Bereich: Eingabe -->
  <div class="panel compact-panel">
    <img src="assets/logo.png" alt="Expoya Logo" class="logo" />
    <h1>AI-Content-Engine</h1>
    <form id="myForm" autocomplete="off">
      <div class="form-group">
        <label for="companyName">Unternehmensname</label>
        <input type="text" id="companyName" name="companyName" required>
      </div>
      <div class="form-group">
        <label for="website">Website</label>
        <input type="url" id="website" name="website">
      </div>
      <div class="form-group" style="display: flex; gap:7px;">
        <div style="flex:1;">
          <label for="expoCount"># Expos</label>
          <input type="number" id="expoCount" name="expoCount" min="1" required>
        </div>
        <div style="flex:1;">
          <label for="branche">Branche</label>
          <select id="branche" name="branche" required>
            <option value="">â€“ wÃ¤hlen â€“</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="regionen">Regionen <span style="color:#6366f1;">( , / ; )</span></label>
        <textarea id="regionen" name="regionen" rows="1" placeholder="OÃ–; NÃ–; Wien"></textarea>
      </div>
      <div class="form-group">
        <label for="zielgruppen">Zielgruppen <span style="color:#6366f1;">( , / ; )</span></label>
        <textarea id="zielgruppen" name="zielgruppen" rows="1" placeholder="Architekten; BautrÃ¤ger"></textarea>
      </div>
      <div class="form-group">
        <label for="produkte">Produkte / DL <span style="color:#6366f1;">( , / ; )</span></label>
        <textarea id="produkte" name="produkte" rows="1" placeholder="Fenster; TÃ¼ren"></textarea>
      </div>
      <div class="form-group">
        <label for="zielsetzung">Zielsetzung der Expos</label>
        <textarea id="zielsetzung" name="zielsetzung" rows="2" placeholder="z. B. 'Mehr Leads fÃ¼r regionale Fensterbauer'"></textarea>
      </div>
      <div class="form-group tonality-row">
        <span class="tonality-label">TonalitÃ¤t</span>
        <input type="range" min="1" max="5" value="3" class="tonality-slider" id="tonality" name="tonality">
        <span class="tonality-value" id="tonality-value">Neutral</span>
      </div>
      <div class="form-group toggle-row">
        <label style="margin:0 4px 0 0;">Mit Ortsbezug</label>
        <label class="switch">
          <input type="checkbox" id="mitOrtsbezug" name="mitOrtsbezug" checked>
          <span class="slider"></span>
        </label>
      </div>
      <div class="form-group toggle-row">
        <label style="margin:0 4px 0 0;">Ansprache</label>
        <label class="switch">
          <input type="checkbox" id="ansprache" name="ansprache" checked>
          <span class="slider"></span>
        </label>
        <span class="toggle-label" id="ansprache-label" style="margin-left:8px;">Du</span>
      </div>
      <button type="submit">ðŸš€ Generieren</button>
    </form>
  </div>

  <!-- Rechter Bereich: Ausgabe -->
  <div class="output-panel">
    <h2 style="margin-top:0;">Titel-Liste</h2>
    <div class="titles-list" id="titlesList"></div>
  </div>
</div>

<script>
  // Branchen dynamisch laden
  fetch("assets/gmb_categories.json")
    .then(r => r.json())
    .then(list => {
      const dropdown = document.getElementById("branche");
      list.forEach(cat => {
        const opt = document.createElement("option");
        opt.value = cat;
        opt.textContent = cat;
        dropdown.appendChild(opt);
      });
    });

  // TonalitÃ¤t Mapping
  const tonalityMap = {
    1: "Locker",
    2: "Eher locker",
    3: "Neutral",
    4: "Eher formell",
    5: "Sehr formell"
  };
  const tonalitySlider = document.getElementById("tonality");
  const tonalityLabel = document.getElementById("tonality-value");
  tonalitySlider.addEventListener("input", () => {
    tonalityLabel.textContent = tonalityMap[tonalitySlider.value];
  });

  // Du/Sie Toggle
  const anspracheToggle = document.getElementById("ansprache");
  const anspracheLabel = document.getElementById("ansprache-label");
  function updateAnsprache() {
    anspracheLabel.textContent = anspracheToggle.checked ? "Du" : "Sie";
  }
  anspracheToggle.addEventListener("input", updateAnsprache);
  updateAnsprache();

  // Form Handling
  document.getElementById("myForm").addEventListener("submit", async function(event) {
    event.preventDefault();

    const data = {
      companyName: document.getElementById("companyName").value,
      website: document.getElementById("website").value,
      expoCount: document.getElementById("expoCount").value,
      branche: document.getElementById("branche").value,
      regionen: document.getElementById("regionen").value,
      zielgruppen: document.getElementById("zielgruppen").value,
      produkte: document.getElementById("produkte").value,
      zielsetzung: document.getElementById("zielsetzung").value,
      tonalitaet: tonalitySlider.value,
      mitOrtsbezug: document.getElementById("mitOrtsbezug").checked,
      ansprache: anspracheToggle.checked ? "Du" : "Sie"
    };

    // TEST-WEBHOOK URL, fÃ¼r PROD einfach wechseln!
    const webhookURL = "https://expoya.app.n8n.cloud/webhook-test/03796224-cbe0-443a-adeb-e91f64514773";

    try {
      const btn = this.querySelector('button[type="submit"]');
      btn.disabled = true;
      btn.textContent = "Wird generiert...";

      const resp = await fetch(webhookURL, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
      });

      let text = "";
      try { text = await resp.text(); } catch(e){}
      document.getElementById("titlesList").innerText = text || "Erfolgreich gesendet!";

      btn.disabled = false;
      btn.textContent = "ðŸš€ Generieren";
    } catch (err) {
      document.getElementById("titlesList").innerText = "Fehler: " + err.message;
      const btn = this.querySelector('button[type="submit"]');
      btn.disabled = false;
      btn.textContent = "ðŸš€ Generieren";
    }
  });
</script>
</body>
</html>
